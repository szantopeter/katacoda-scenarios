### Architecture of the micro services created in this tutorial 

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="845px" viewBox="-0.5 -0.5 845 405" content="&lt;mxfile modified=&quot;2019-04-08T19:55:48.514Z&quot; host=&quot;www.draw.io&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot; etag=&quot;JLzWOL8cidkl0PKdhosu&quot; version=&quot;10.6.0&quot; type=&quot;google&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;e3a06f82-3646-2815-327d-82caf3d4e204&quot;&gt;7Vlbc9sqEP41nmkf2hFCF+vRdtJ2Jm0nM5m0zSOWsMQpFi5CvvTXFySwbnbi45Frtef4IYFvuSy7+y0gRnC23L7naJV8YhGmI9uKtiN4M7LtsWPJvwrYlYATOCUQcxKVEKiAB/ITa1D3i3MS4azRUDBGBVk1wZClKQ5FA0Ocs02z2YLR5qwrFOMO8BAiatC3boV/JZFINA68oBJ8wCRO9ORj2ysFcxR+jznLUz1jylJcSpbIDKNXmSUoYpsaBG9HcMYZE2VpuZ1hquxqbGb6iZ1RdASniVhSWQGyWIjfHekMTuks18VxKurTHRtvAiN0+/h49+WOTCyfuzs8g2/0JGtEczOJ7VE53jQi68bs3o9crXMq8Fa8QZTE6QhOZAuKF6KSylKs/xejZCuUGuwDy4TBpZp1UQ0u5jVoywCFm7BajyXFm4QI/LBCoZJuZFw37aN1vAmlfTCXwBpzQWTMTLRAMNVjQSidMcp4MQWMXDyOHKW54Ow7rknG9hx63l5iosw96ApjVzkl3tYg7Zr3mC2x4DvZREs934SwpuDY0tGzqcJ5z9OkFsmOaYg0ieL94FU0yIIOiH8RHHYnOO7yOeYpFpLrtpXKLHINFy0WCzsMD7ko8uaeezEXjdsuCtyui/zggItseCkXeR0H4EhmRl1lXCQsZimitxU6bbqoavORKWsXjvkHC7HTaR7lgjXdJk3Id99U/7eu5xvgqQAssAdutnqKsrar1+4xJ9ICyukF2HGlVfykJMz5ulAWFM0QFxO1YaiooSjLSGjgd4QeT40mmbKch/gZe0K9eSEeY/FMO709KmM/GzocUyTIurl59R4FsEPUzwU3rQzzNQlV6RVlKCq2O4rSEPPXPTO3B36BoEkvYB1IgcA7wC/vUvRynjOsXPfwbAhaNgSHbGj/Thu6f5oNoTHZcGzoXzvNN5L8Cwm+31yOt0TUlJC1p5qkUkFVjAaXz/9u3/lfd71nRKq8D0V73E6JfivEyhXpbvXTf2skEMBWUIOWNuWaOyMV8bpf0fkhPL52CP9lJ5XgxEg1V/SBHFWCv+Ko4tntu8AADisAnkGxRtD2xzfQ5Jr7AtNOZMtx7p3PI8OPF4kEB8Ujo3aXSCElWKfwQXHGdTqcuf7BCjj/c+YMzphvvH8YZ7pfOwfOGR/aA+SMfe2j3H/lNnLyGQ/0zbPDlwgfdI89515IPNvthPZvvpKAc67V/Sb/ayZx98ToCoaVxLvfkx6zA5+RsgStVDFf0kkoWP114SOaY3rPMiIIUxl7zoRgS9mAKsF0/yDYfHOQv6MvFDWPslxQkkpfmZfOKgnV3yMusVs4fnu32D8Y1TYL2M9eIavVy2fJyOppGd7+Ag==&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:405px;"><defs/><g><rect x="2.5" y="2" width="840" height="400" fill="#d5e8d4" stroke="#82b366" stroke-width="5" pointer-events="none"/><g transform="translate(410.5,11.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="24" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 26px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div style="text-align: left"><span>Host</span></div></div></div></foreignObject><text x="12" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="22.5" y="152" width="790" height="230" fill="#fff2cc" stroke="#d6b656" stroke-width="5" pointer-events="none"/><g transform="translate(371.5,161.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 92px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Kubernetes node</div></div></foreignObject><text x="46" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Kubernetes node</text></switch></g><path d="M 210 268.37 Q 210 282 164 282 Q 118 282 118 296.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 210 263.12 L 213.5 270.12 L 210 268.37 L 206.5 270.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 118 301.88 L 114.5 294.88 L 118 296.63 L 121.5 294.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="130" y="202" width="160" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(132.5,225.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="154" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 154px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node service (load balancer)</div></div></foreignObject><text x="77" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node service (load balancer)</text></switch></g><rect x="50" y="302" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(76.5,325.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="66" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node server</div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node server</text></switch></g><rect x="235" y="302" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(261.5,325.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="66" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node server</div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node server</text></switch></g><path d="M 210 268.37 Q 210 282 252.5 282 Q 295 282 295 295.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 210 263.12 L 213.5 270.12 L 210 268.37 L 206.5 270.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 295 300.88 L 291.5 293.88 L 295 295.63 L 298.5 293.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 643 268.37 Q 643 282 597 282 Q 551 282 551 296.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 643 263.12 L 646.5 270.12 L 643 268.37 L 639.5 270.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 551 301.88 L 547.5 294.88 L 551 296.63 L 554.5 294.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="562.5" y="202" width="160" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(565.5,225.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="154" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 154px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node service (load balancer)</div></div></foreignObject><text x="77" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node service (load balancer)</text></switch></g><path d="M 476.13 332 Q 386 332 386 282 Q 386 232 296.37 232" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 481.38 332 L 474.38 335.5 L 476.13 332 L 474.38 328.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 291.12 232 L 298.12 228.5 L 296.37 232 L 298.12 235.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="482.5" y="302" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(512.5,325.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="60" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 62px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node client</div></div></foreignObject><text x="30" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node client</text></switch></g><path d="M 661.13 332 Q 479 332 479 282 Q 479 232 296.37 232" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 666.38 332 L 659.38 335.5 L 661.13 332 L 659.38 328.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 291.12 232 L 298.12 228.5 L 296.37 232 L 298.12 235.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="667.5" y="302" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(697.5,325.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="60" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 62px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node client</div></div></foreignObject><text x="30" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node client</text></switch></g><path d="M 643 268.37 Q 643 282 685.5 282 Q 728 282 728 295.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 643 263.12 L 646.5 270.12 L 643 268.37 L 639.5 270.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 728 300.88 L 724.5 293.88 L 728 295.63 L 731.5 293.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 443.87 72 Q 643 72 643 195.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 438.62 72 L 445.62 68.5 L 443.87 72 L 445.62 75.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 643 200.88 L 639.5 193.88 L 643 195.63 L 646.5 193.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="423" cy="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" stroke-width="5" pointer-events="none"/><path d="M 422.5 57 L 422.5 82 M 422.5 62 L 407.5 62 M 422.5 62 L 437.5 62 M 422.5 82 L 407.5 102 M 422.5 82 L 437.5 102" fill="none" stroke="#000000" stroke-width="5" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(409.5,111.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="25" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">User</div></div></foreignObject><text x="13" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">User</text></switch></g></g></svg>

### Steps

In this step we will build a client application calling the server using the internal DNS entry node-server. The client application is also a server so we can call it.

Delete the service of node-server. We want to keep it internally accessible only `kubectl delete service/node-server`{{execute T1}}

Re-create node-server service without exposing the port. We want to keep the service internally accessible only `kubectl expose deployment node-server --name=node-server`{{execute T1}}

Change to client directory `cd /root/node-client`{{execute T1}}

Build docker image `docker build -t exampledriven/node-client:v1 .`{{execute T1}}

Run client in kubernetes `kubectl run node-client --port=3000 --image=exampledriven/node-client:v1`{{execute T1}}

Create a service `kubectl expose deployment node-client --type=NodePort --name=node-client`{{execute T1}}

Scale up the client instances  `kubectl scale deployment.apps/node-client --replicas=4`{{execute T1}}

Store kubernetes ip address in a variable `masterip=$(kubectl cluster-info | grep master | grep -o "[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}")`{{execute T1}}

Store service port into variable `clientserviceport=$(kubectl get service | grep node-client | grep -o "[0-9]\{5\}")`{{execute T1}}

See all objects created in Kubernetes `kubectl get all`{{execute T1}}

Observe load balancing in action `watch curl $masterip:$clientserviceport`{{execute T1}}