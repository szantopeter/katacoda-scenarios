### Architecture, created in this step

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="408px" viewBox="-0.5 -0.5 408 405" content="&lt;mxfile modified=&quot;2019-04-08T19:59:41.645Z&quot; host=&quot;www.draw.io&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot; etag=&quot;SiDWX3-5EZstK73ATJbv&quot; version=&quot;10.6.0&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;kSwaE8T7Z9bF23whZrkk&quot; name=&quot;Page-1&quot;&gt;1VjbctowEP0aZtoHOr4Dj0Bu06SdzGQ6TR6FLYwSYVF5zaVf35Ut+YKBJikkqR+wdHYlrXbPrpA77ni+vpRkMfsmIso7jhWtO+5Zx3H6noW/CtgUgDfwCiCWLCoguwLu2G+qQT0uzlhE04YiCMGBLZpgKJKEhtDAiJRi1VSbCt5cdUFi2gLuQsLb6E8WwUxvy7cq/IqyeGZWti0tmROjrIF0RiKxqkHueccdSyGgaM3XY8qV74xfinEXe6SlYZIm8JwBxOIXsger++sRdLuX3qP/VXb1LEvCM73hjhNwnG8UsaUyGjbaE8GvTFk6ArqGLuEsTjruEDU4nUIlxVas3/ks6YIkBrsSKRgczayLanC+rkGdhgmOFFkSUbUfC8WrGQN6tyChkq6QfYjNYM6xZ2NT23gWon+oRGBJJTCM7FALQKgRU8b5WHAh8yXcyKf9yFOWgxRPtCbpOxM3CEqJYYNfGloPhfErLknXNUiH5pKKOQW5QRUtDfrFCJ0mfUOjVUU6z3ILbFYjnGcUiSZ6XE5dcQEbmg4voIbTosZ1NqEyoYD56FgJZvp7BGg6nTphuCtAUTAJ/JMFqN8M0MBvB8gNdgTIcU8VILflfhph7dJdIWEmYpEQfl6ho2aAKp0boXydh+WRAmx0ISYZiGbQ0IFyc6/Gf/GDngEecsCyS+BsrZcoept675ZKhh5QIc/BViCt/EFJmMllbqydqxEJQ1XSFWc4SVMWGviCcWPg3lCnIpMhPeBPfTDhfDGFA3p+oaecfZA4knICbNk8SI7OAq+Vpt/zzLRSKpcsVK1PXJAI3xPCSRJS+fnIeXuE7LIHfiO9bGtHAbQDq51fwanSyz/kWNz3x/OhveVDe5cPnbf0YfC/+dA1Lvs4Puy9d5lvFPm/FPjj1nK6ZlAzAnsPNUllguoYC05f/4Nj13899FYwNLmkIl4ytkpib4tixY70sPo//62Z7IG7RWp7y5piz62Zcr6WO3o9hU1hehGHG4T5Z0I/k3H7+fvajHg9H+3gmYT03oaQPau/Rcjtu8epadQ+Tn6kO04RvGkvVDOb82EIon61uCETym9FyoAJdXZMBICYowJXghEJn+Kcas0LBz57ryc1jokMOEuQPeZTRFUR65eRU5xb5fFj7o+7rifHObWwW320KEJbfflxz/8A&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:405px;"><defs/><g><rect x="2" y="2" width="403" height="400" fill="#d5e8d4" stroke="#82b366" stroke-width="5" pointer-events="none"/><g transform="translate(190.5,11.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="25" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 25px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div style="text-align: left"><span>Host</span></div></div></div></foreignObject><text x="13" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="22" y="152" width="363" height="230" fill="#fff2cc" stroke="#d6b656" stroke-width="5" pointer-events="none"/><g transform="translate(157.5,161.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="91" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 93px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Kubernetes node</div></div></foreignObject><text x="46" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Kubernetes node</text></switch></g><path d="M 209 268.37 Q 209 282 163 282 Q 117 282 117 296.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 209 263.12 L 212.5 270.12 L 209 268.37 L 205.5 270.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 117 301.88 L 113.5 294.88 L 117 296.63 L 120.5 294.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="129" y="202" width="160" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(131.5,225.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="154" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 154px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node service (load balancer)</div></div></foreignObject><text x="77" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node service (load balancer)</text></switch></g><rect x="49" y="302" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(75.5,325.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="66" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node server</div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node server</text></switch></g><rect x="234" y="302" width="120" height="60" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(260.5,325.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="66" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 66px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Node server</div></div></foreignObject><text x="33" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Node server</text></switch></g><path d="M 209 268.37 Q 209 282 251.5 282 Q 294 282 294 295.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 209 263.12 L 212.5 270.12 L 209 268.37 L 205.5 270.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 294 300.88 L 290.5 293.88 L 294 295.63 L 297.5 293.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 209 118.37 Q 209 118.37 209 195.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 209 113.12 L 212.5 120.12 L 209 118.37 L 205.5 120.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 209 200.88 L 205.5 193.88 L 209 195.63 L 212.5 193.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="209" cy="60" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" stroke-width="5" pointer-events="none"/><path d="M 209 67 L 209 92 M 209 72 L 194 72 M 209 72 L 224 72 M 209 92 L 194 112 M 209 92 L 224 112" fill="none" stroke="#000000" stroke-width="5" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(196.5,121.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="25" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">User</div></div></foreignObject><text x="13" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">User</text></switch></g></g></svg>
### Steps

Run server in kubernetes `kubectl run node-server --port=3000 --image=exampledriven/node-server:v1`{{execute T1}}

the above single command created the following 
- Deployment : Describes and maintains the desired state of the deployed pods
- Pod : the actual server
- Replica sets : controls and maintains the desired amount of server instances

To query all this run  `kubectl get all`{{execute T1}}

Create a service `kubectl expose deployment node-server --type=NodePort --name=node-server`{{execute T1}}

The above command created
- a load balancer pointing to node-server instnces
- a DNS entry "node-service" pointing to the load balancer
- a port mapping forwarding the kubernetes internal network and the host machine 

To query all this run  `kubectl get all`{{execute T1}}

Store kubernetes ip address in a variable `masterip=$(kubectl cluster-info | grep master | grep -o "[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}")`{{execute T1}}

Store service port into variable `serviceport=$(kubectl get service | grep node-server | grep -o "[0-9]\{5\}")`{{execute T1}}

Connect to the server `curl $masterip:$serviceport`{{execute T1}}

To create more node server instances  `kubectl scale deployment.apps/node-server --replicas=4`{{execute T1}}

See the changes `kubectl get all`{{execute T1}}

Observe load balancing in action `watch curl $masterip:$serviceport`{{execute T1}}





